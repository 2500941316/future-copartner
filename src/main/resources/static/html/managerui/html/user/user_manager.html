<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>人员管理</title>

    <script src='../../js/header.js'></script>
    <link rel="stylesheet" type="text/css" href="../../css/layout.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/hyzx.css"/>
    <link type="text/css" rel="stylesheet" href="../../../webui/css/home.css"/>
    <script type="text/javascript" src="../../js/leasson_manager.js"></script>
</head>
<body>
<!--引入页头页面-->
<div id="hy_con">
    <div id="con_lf">
        <h2>管理列表</h2>
        <ul>
            <li class="lf_li1"><a href="../../../managerui/index.html">申请审批</a></li>
            <li class="lf_li1"><a href="../../../managerui/html/user/user_manager.html">人员管理</a></li>
            <li class="lf_li1"><a href="../../../managerui/html/project/project_manager.html">项目管理</a></li>
            <li class="lf_li1"><a href="../../../managerui/html/news/news_manager.html">社区管理</a></li>
            <li class="lf_li1"><a href="../../../managerui/html/leasson/leasson_manager.html">课程管理</a></li>
            <li class="lf_li1"><a href="../../../managerui/html/supervisor/supervisor_manager.html">导师管理</a></li>
            <li class="lf_li1"><a href="../../../managerui/html/activity/activity_manager.html">活动管理</a></li>
            <li class="lf_li1"><a href="../../../managerui/html/live/live_manager.html">直播管理</a></li>
            <li class="lf_li1"><a href="../../../managerui/html/carousel/carousel_manager.html">广告管理</a></li>
        </ul>
    </div>
    <div id="con_rh">
        <div class="con_rh_con">
            <p class="rh_title">人员管理</p>
            <div class="layui-tab" lay-filter="demo">
                <ul class="layui-tab-title">
                    <li class="layui-this">注册审批</li>
                    <li class="layui-this" onclick="viewPeopleTable()">用户管理</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <!--引入layui表格-->
                        <table id="register" lay-filter="projectTable"></table>

                        <script type="text/html" id="projectOperate">
                            <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                            <a class="layui-btn layui-btn-xs" lay-event="pass">通过</a>
                            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="reject">驳回</a>
                        </script>
                    </div>

                    <!--用户管理模块，主要功能是设置为管理员-->
                    <div class="layui-tab-item">
                        <!--引入layui表格-->
                        <table id="peopleManage" lay-filter="peopleTable"></table>

                        <script type="text/html" id="peopleOperate">
                            <a class="layui-btn layui-btn-xs" lay-event="manage">设置为管理员</a>
                        </script>
                    </div>
                </div>


                <form class="layui-form layui-form-pane" lay-filter="student" id="student"
                      style="width: 90%;margin: 0 auto;display: none">
                    <span style="margin: 5px"> 基本信息</span>
                    <hr>
                    <div class="layui-form-item">
                        <label class="layui-form-label">姓名</label>
                        <div class="layui-input-inline">
                            <input type="text" name="name" lay-verify="required" disabled
                                   placeholder="必填"
                                   autocomplete="off"
                                   class="layui-input">
                        </div>

                        <div class="layui-inline">
                            <label class="layui-form-label">入学日期</label>
                            <div class="layui-inline">
                                <input type="text" disabled name="admissiondate" class="layui-input" id="test1">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">性别</label>
                            <div class="layui-input-inline">
                                <input type="radio" name="sex" disabled value="男" title="男" checked="">
                                <input type="radio" name="sex" disabled value="女" title="女">
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">学号</label>
                        <div class="layui-input-inline">
                            <input type="text" name="studentnumber" lay-verify="number"
                                   placeholder="请输入"
                                   disabled
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">学院</label>
                            <div class="layui-input-inline">
                                <input type="text" name="department" lay-verify="required"
                                       placeholder="请输入"
                                       disabled
                                       autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">专业</label>
                            <div class="layui-input-inline">
                                <input type="text" name="major" lay-verify="required"
                                       placeholder="请输入"
                                       disabled
                                       autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                    </div>
                </form>

                <form class="layui-form layui-form-pane" lay-filter="teacher" id="teacher"
                      style="width: 90%;margin: 0 auto;display: none">
                    <span style="margin: 5px"> 基本信息</span>
                    <hr>
                    <div class="layui-form-item">
                        <label class="layui-form-label">教工号</label>
                        <div class="layui-input-inline">
                            <input type="text" name="teachernumber" lay-verify="required"
                                   placeholder="请输入"
                                   disabled
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">姓名</label>
                            <div class="layui-input-inline">
                                <input type="text" name="name" lay-verify="required"
                                       placeholder="请输入"
                                       disabled
                                       autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">学院</label>
                            <div class="layui-input-inline">
                                <input type="text" name="department" lay-verify="required" placeholder="请输入"
                                       autocomplete="off"
                                       disabled
                                       class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">邮箱</label>
                            <div class="layui-input-inline">
                                <input type="text" name="mail" lay-verify="email"
                                       placeholder="请输入"
                                       disabled
                                       autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                    </div>
                </form>

                <form class="layui-form layui-form-pane" lay-filter="company" id="company"
                      style="width: 90%;margin: 0 auto;display: none">
                    <span style="margin: 5px"> 属性</span>
                    <hr>
                    <div class="layui-form-item">
                        <label class="layui-form-label">是否属于</label>
                        <div class="layui-input-block">
                            <input type="checkbox" disabled name="labelalumnus" title="校友">
                            <input type="checkbox" disabled name="labelperson" title="非校友">

                            <!--<input type="checkbox" disabled name="labelalumnicompany" title="校友企业">
                            <input type="checkbox" disabled name="labelincubator" title="孵化器">
                            <input type="checkbox" disabled name="labelinstitutions" title="投资机构">
                            <input type="checkbox" disabled name="labelother" title="其他">-->
                        </div>
                    </div>

                    <span style="margin: 5px"> 个人信息</span>
                    <hr>

                    <div class="layui-form-item">
                        <label class="layui-form-label">姓名</label>
                        <div class="layui-input-inline">
                            <input type="text" name="name" lay-verify="required"
                                   placeholder="必填"
                                   disabled
                                   autocomplete="off"
                                   class="layui-input">
                        </div>

                        <div class="layui-inline">
                            <label class="layui-form-label">出生日期</label>
                            <div class="layui-inline"> <!-- 注意：这一层元素并不是必须的 -->
                                <input type="text" disabled class="layui-input" name="birthday" id="birthday">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">性别</label>
                            <div class="layui-input-inline">
                                <input type="radio" disabled name="sex" value="男" title="男" checked="">
                                <input type="radio" disabled name="sex" value="女" title="女">
                            </div>
                        </div>
                    </div>

                    <span style="margin: 5px"> 教育经历</span>
                    <hr>
                    <div class="layui-form-item">
                        <label class="layui-form-label">学校</label>
                        <div class="layui-input-inline">
                            <input type="text" name="campus" lay-verify="required"
                                   placeholder="必填"
                                   disabled
                                   autocomplete="off"
                                   class="layui-input">
                        </div>


                        <label class="layui-form-label">专业</label>
                        <div class="layui-input-inline">
                            <input type="text" name="major" lay-verify="required"
                                   placeholder="必填"
                                   disabled
                                   autocomplete="off"
                                   class="layui-input">
                        </div>

                        <div class="layui-inline">
                            <label class="layui-form-label">毕业时间</label>
                            <div class="layui-input-block">
                                <input type="text" disabled name="gradutedate" id="gradutedate" autocomplete="off"
                                       class="layui-input">
                            </div>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">学历</label>
                        <div class="layui-input-block">
                            <select name="education" disabled lay-filter="required">
                                <option value=""></option>
                                <option value="0" selected="">专科</option>
                                <option value="1">本科</option>
                                <option value="2">研究生</option>
                            </select>
                        </div>
                    </div>


                    <span style="margin: 5px"> 工作</span>
                    <hr>
                    <div class="layui-form-item">
                        <label class="layui-form-label">企业名称</label>
                        <div class="layui-input-inline">
                            <input type="text" name="company" lay-verify="required"
                                   placeholder="必填"
                                   disabled
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <label class="layui-form-label">职位</label>
                        <div class="layui-input-inline">
                            <input type="text" name="workername" lay-verify="required"
                                   placeholder="必填"
                                   disabled
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-inline">
                            <div class="layui-input-block" style="margin: auto;">
                                <input type="checkbox" disabled name="labelalumnicompany" title="校友企业">
                                <!--<input type="checkbox" name="labelincubator" title="孵化器">-->
                                <input type="checkbox" disabled name="labelinstitutions" title="投资机构">
                                <input type="checkbox" disabled name="labelother" title="其他">
                            </div>
                        </div>
                    </div>
                    <span style="margin: 5px"> 介绍</span>
                    <hr>
                    <div class="layui-form-item">
                        <label class="layui-form-label">一句话介绍</label>
                        <div class="layui-input-block">
                                            <textarea name="description" placeholder="请输入内容" disabled
                                                      class="layui-textarea"></textarea>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">期望</label>
                        <div class="layui-input-block">
                            <input type="checkbox" disabled name="expectproject" title="找项目">
                            <input type="checkbox" disabled name="expectstudent" title="找学生">
                            <input type="checkbox" disabled name="expectother" title="其他">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">成为导师</label>
                        <div class="layui-input-block">
                            <input type="radio" disabled name="supervisor" value="true" title="是" checked="">
                            <input type="radio" disabled name="supervisor" value="false" title="否">
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

<!--引入尾部页面-->
<div id="footer"></div>


<script type="application/javascript">
    var form;
    $(function () {
        RegisterManage();
    })

    layui.use(['form'], function () {
        form = layui.form;
    });

    /**
     *项目信息管理表格
     */
    function RegisterManage() {
        layui.use('table', function () {
            var table = layui.table;

            // 项目信息管理表格
            table.render({
                elem: '#register'
                , url: '/manager/user/searchAllRegistry'
                , parseData: function (res) { //res 即为原始返回的数据
                    //处理类型赋值
                    for (var i in res.data) {
                        switch (res.data[i].auth) {
                            case "ROLE_STUDENT":
                                res.data[i].auth = "学生";
                                break;
                            case "ROLE_TEACHER":
                                res.data[i].auth = "教师";
                                break;
                            case "ROLE_PERSON":
                                res.data[i].auth = "校外人员";
                                break;
                        }
                    }
                    return {
                        "code": res.code, //解析接口状态
                        "msg": res.message, //解析提示文本
                        "count": res.count, //解析数据长度
                        "data": res.data //解析数据列表
                    };
                }
                , cols: [[
                    {
                        field: 'id',
                        title: 'ID',
                        fixed: 'left',
                        width: 80,
                        unresize: true,
                        sort: true,
                        align: 'center',
                        type: 'numbers'
                    }
                    , {field: 'auth', title: '类型', align: 'center'}
                    , {field: 'phone', title: '账号', align: 'center'}
                    , {field: 'name', title: '姓名', width: 80, align: 'center'}
                    , {field: 'applydate', title: '申请日期', sort: true, align: 'center'}
                    , {fixed: 'right', title: '操作', toolbar: '#projectOperate', width: 180, align: 'center'}
                ]]
                , page: true
            });
            //监听操作栏
            table.on('tool(projectTable)', function (obj) {
                if (obj.event === 'detail') {
                    viewProjectInfo(obj);
                } else if (obj.event === 'pass') {
                    passRegistry(obj);
                } else if (obj.event === 'reject') {
                    layer.prompt({
                        formType: 2,
                        value: '',
                        title: '请输入驳回原因'
                    }, function (value, index) {
                        if (value != null) {
                            operateProject(obj.data.id, obj.data.phone,value);
                            layer.close(index);
                            obj.del();
                        }
                    });
                }
            });
        })
    }

    /**
     * 对话框查看注册人信息
     */
    function viewProjectInfo(obj) {
        var type;
        //表单赋值
        if (obj.data.auth === "学生") {
            form.val('student', obj.data);
            type = "student";
        } else if (obj.data.auth === "教师") {
            form.val('teacher', obj.data);
            type = "teacher";
        } else {
            form.val('company', obj.data);
            type = "company";
        }


        layer.open({
            type: 1,
            area: ['1080px'],
            title: '注册信息',
            content: $("#" + type),
            shade: 0.1,
            btn: []
        });
    }


    /**
     * 驳回注册申请
     */
    function operateProject(id,phone, value) {
        $.ajax({
            url: "/manager/user/rejectRegistry",
            type: "GET",
            data: {
                "id": id,
                "value": value,
                "phone": phone
            },
            success: function (res) {
                if (res.code === 200) {
                    layer.msg("驳回成功！", {shade: 0.01})
                } else {
                    layer.msg("网络异常！");
                }
            }
        })
    }


    /**
     * 通过注册请求
     */
    function passRegistry(obj) {
        switch (obj.data.auth) {
            case "学生":
                obj.data.auth = "ROLE_STUDENT";
                break;
            case "教师":
                obj.data.auth = "ROLE_TEACHER";
                break;
            case "校外人员":
                obj.data.auth = "ROLE_PERSON";
                break;
        }

        $.ajax({
            url: "/manager/user/passRegistry",
            type: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            data: JSON.stringify(obj.data),
            success: function (res) {
                if (res.code === 200) {
                    layer.msg("审批成功！", {shade: 0.01})
                    obj.del();
                } else {
                    layer.msg("网络异常！");
                }
            }
        })
    }

    function viewPeopleTable() {
        layui.use('table', function () {
            var table = layui.table;
            /*var data = [{
                userid: "1",
                name: '张三',
                phone: "18019178233",
                auth: 'ROLE_STUDENT',
                registryDate: '2020-01-06'
            }];*/
            // 用户管理表格
            table.render({
                elem: '#peopleManage'
                , url: '/manager/user/searchUserExceptManager'
                //,data: data
                , title: '用户信息表格'
                ,loading: true
                , cols: [[
                    {
                        field: 'userid', title: 'ID', fixed: 'left', width: 80,unresize: true, sort: true, align: 'center',type:'numbers'
                    }
                    , {field: 'name', title: '用户名称', align: 'center'}
                    , {field: 'phone', title: '联系方式', align: 'center'}
                    , {field: 'auth', title: '用户类型',width: 150, sort: true, align: 'center',templet: function(res){
                            if(res.auth === 'ROLE_STUDENT'){return '学生';}
                            else if(res.auth === 'ROLE_TEACHER'){return '教师';}
                            else if(res.auth === 'ROLE_PERSON'){return '校外人员';}
                        }}
                    , {field: 'registrydate', title: '注册时间', align: 'center'}
                    , {fixed: 'right', title: '操作', toolbar: '#peopleOperate', width: 190, align: 'center'}
                ]]
                , page: true
                ,limits: [10]
            });
            //监听操作栏
            table.on('tool(peopleTable)', function (obj) {
              if(obj.event === 'manage'){
                  layer.confirm('确认设置为管理员？', function (index) {
                      setManager(obj.data.userid);
                      layer.close(index);
                      obj.del();
                  });

                }
            });
        })
    }


    /**
     * 设置为管理员
     * @param userid
     */
    function setManager(userid) {
        $.ajax({
            url: "/manager/user/setManager",
            type: "GET",
            data: "userid="+userid,
            success: function (res) {
                if (res.code === 200) {
                    layer.msg("已处理！", {icon:1,shade: 0.01,time:1000})
                } else {
                    layer.msg("网络异常！");
                }
            }
        })
    }


</script>

</body>
</html>
