<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>人员管理</title>
    <script src='/html/webui/header/header.js'></script>
    <link rel="stylesheet" type="text/css" href="/html/managerui/css/layout.css"/>
    <link rel="stylesheet" type="text/css" href="/html/managerui/css/hyzx.css"/>
    <link type="text/css" rel="stylesheet" href="/html/webui/css/home.css"/>
    <link rel="stylesheet" type="text/css" href="/html/managerui/js/layui/css/layui.css"/>
    <script type="text/javascript" src="/html/managerui/js/layui/layui.js"></script>
    <script type="text/javascript" src="/html/managerui/js/leasson_manager.js"></script>
</head>
<body>
<!--引入页头页面-->
<div id="hy_con">
    <div id="con_lf">
        <h2>管理列表</h2>
        <ul>
            <li class="lf_li1"><a href="/html/managerui/index.html">申请审批</a></li>
            <li class="lf_li1"><a href="/html/managerui/html/user/user_manager.html">人员管理</a></li>
            <li class="lf_li1"><a href="/html/managerui/html/project/project_manager.html">项目管理</a></li>
            <li class="lf_li1"><a href="#">新闻管理</a></li>
            <li class="lf_li1"><a href="/html/managerui/html/leasson/leasson_manager.html">课程管理</a></li>
            <li class="lf_li1"><a href="/html/managerui/html/supervisor/supervisor_manager.html">导师管理</a></li>
            <li class="lf_li1"><a href="/html/managerui/html/activity/activity_manager.html">活动管理</a></li>
        </ul>
    </div>
    <div id="con_rh">
        <div class="con_rh_con">
            <p class="rh_title">人员管理</p>
            <div class="layui-tab" lay-filter="demo">
                <ul class="layui-tab-title">
                    <li class="layui-this">注册审批</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <!--引入layui表格-->
                        <table id="register" lay-filter="projectTable"></table>

                        <script type="text/html" id="projectOperate">
                            <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                            <a class="layui-btn layui-btn-xs" lay-event="pass">通过</a>
                            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="reject">驳回</a>
                        </script>
                    </div>
                </div>

                <form class="layui-form" id="test" style="display:none">
                    <div class="layui-form-item">
                        <label class="layui-form-label">状态：</label>
                        <div class="layui-input-block">
                            <input type="radio" name="type" value="在创" title="在创" checked>
                            <input type="radio" name="type" value="可选" title="可选">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--引入尾部页面-->
<div id="footer"></div>


<script type="application/javascript">

    $(function () {
        RegisterManage();
    })

    /**
     *项目信息管理表格
     */
    function RegisterManage() {
        layui.use('table', function () {
            var table = layui.table;

            // 项目信息管理表格
            table.render({
                elem: '#register'
                , url: '/manager/user/searchAllRegistry'
                , parseData: function (res) { //res 即为原始返回的数据
                    //处理类型赋值
                    for (var i in res.data) {
                        switch (res.data[i].auth) {
                            case "ROLE_STUDENT":
                                res.data[i].auth = "学生";
                                break;
                            case "ROLE_TEACHER":
                                res.data[i].auth = "教师";
                                break;
                            case "ROLE_PERSON":
                                res.data[i].auth = "校外人员";
                                break;
                        }
                    }
                    return {
                        "code": res.code, //解析接口状态
                        "msg": res.message, //解析提示文本
                        "count": res.count, //解析数据长度
                        "data": res.data //解析数据列表
                    };
                }
                , cols: [[
                    {
                        field: 'id',
                        title: 'ID',
                        fixed: 'left',
                        width: 80,
                        unresize: true,
                        sort: true,
                        align: 'center',
                        type: 'numbers'
                    }
                    , {field: 'auth', title: '类型', align: 'center'}
                    , {field: 'phone', title: '账号', align: 'center'}
                    , {field: 'name', title: '姓名', width: 80, align: 'center'}
                    , {field: 'applydate', title: '申请日期', sort: true, align: 'center'}
                    , {fixed: 'right', title: '操作', toolbar: '#projectOperate', width: 180, align: 'center'}
                ]]
                , page: true
            });
            //监听操作栏
            table.on('tool(projectTable)', function (obj) {
                if (obj.event === 'detail') {
                    viewProjectInfo(obj);
                } else if (obj.event === 'pass') {
                    passRegistry(obj.data);
                } else if (obj.event === 'reject') {
                    layer.prompt({
                        formType: 2,
                        value: '',
                        title: '请输入驳回原因'
                    }, function (value, index) {
                        if (value != null) {
                            operateProject(obj.data.id, value);
                            layer.close(index);
                            obj.del();
                        }
                    });
                }
            });
        })
    }

    /**
     * 对话框查看注册人信息
     */
    function viewProjectInfo(obj) {
        layer.open({
            type: 1,
            area: ['30%', '25%'],
            title: '状态设置'
            , content: $("#test"),
            shade: 0.1,
            btn: []
        });
    }


    /**
     * 驳回注册申请
     */
    function operateProject(id, value) {
        $.ajax({
            url: "/manager/user/rejectRegistry",
            type: "GET",
            data: {
                "id": id,
                "value": value
            },
            success: function (res) {
                if (res.code === 200) {
                    layer.msg("驳回成功！", {shade: 0.01})
                } else {
                    layer.msg("网络异常！");
                }
            }
        })
    }


    /**
     * 通过注册请求
     */
    function passRegistry(obj) {
        $.ajax({
            url: "/manager/user/passRegistry",
            type: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            data: JSON.stringify(obj),
            success: function (res) {
                if (res.code === 200) {
                    layer.msg("审批成功！", {shade: 0.01})
                } else {
                    layer.msg("网络异常！");
                }
            }
        })
    }


</script>

</body>
</html>
