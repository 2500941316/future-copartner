<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>个人工作台</title>
    <link rel="stylesheet" type="text/css" href="/html/managerui/css/layout.css"/>
    <link rel="stylesheet" type="text/css" href="/html/managerui/css/hyzx.css"/>
    <link type="text/css" rel="stylesheet" href="/html/webui/css/home.css"/>
    <link rel="stylesheet" type="text/css" href="/html/managerui/js/layui/css/layui.css"/>
    <script type="text/javascript" src="/html/webui/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="/html/managerui/js/layui/layui.js"></script>
</head>
<body>
<!--引入页头页面-->
<div id="headers" style="margin-bottom: 20px"></div>

<div id="hy_con">
    <div id="con_lf">
        <h2>管理列表</h2>
        <ul>
            <li class="lf_li1"><a href="/html/managerui/index.html">申请审批</a></li>
            <li class="lf_li1"><a href="#">项目管理</a></li>
            <li class="lf_li1"><a href="#">新闻管理</a></li>
            <li class="lf_li1"><a href="/html/managerui/html/leasson/leasson_manager.html">课程管理</a></li>
        </ul>
    </div>
    <div id="con_rh">
        <div class="con_rh_con">
            <p class="rh_title">课程管理</p>
            <div class="layui-tab" lay-filter="demo">
                <ul class="layui-tab-title">
                    <li class="layui-this">课程发布</li>
                    <li class="layui-this">课程管理</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">

                        <div class="perRightcon">
                            <div class="ydc-column ydc-column-8">
                                <div class="ydc-release-content">
                                    <div class="ydc-tabPanel ydc-tabPanel-release">

                                        <div class="ydc-panes">
                                            <div class="ydc-pane" style="display:block;">
                                                <div class="ydc-release-form-group ">
                                                    <div class="ydc-warning-default">
                                                        <p>课名字数需在1字到15字之间。</p>
                                                    </div>
                                                    <div class="ydc-release-form-group-input">
                                                        <input type="text" name="title" lay-verify="title"
                                                               autocomplete="off" id="title"
                                                               placeholder="请输入课程标题，建议字数在15个汉字以内"
                                                               onkeyUp="textLimitCheck(this, 15);" class="layui-input">
                                                        <div class="ydc-form-group-jl">
                                                            <span id="messageCount">0</span>
                                                            /30
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ydc-release-form-text">
                                <textarea class="layui-textarea" id="LAY_demo1"
                                          style="display: none">填写课程概述，注意排版和布局</textarea>
                                                </div>
                                                <div class="ydc-release-form-group-input">
                                                    <input type="text" name="title" lay-verify="title"
                                                           autocomplete="off"
                                                           placeholder="请输入上课老师" id="teacher"
                                                           class="layui-input">

                                                </div>
                                                <div class="ydc-form-city" style="margin-top: 5px">

                                                    <div class="layui-row">
                                                        <div class="layui-col-xs6">
                                                            <div class="grid-demo grid-demo-bg1">

                                                                <div class="aui-card-form-item">
                                                                    <label class="aui-card-form-label">分类:</label>
                                                                    <div class="aui-card-form-input">
                                                                        <select id="category">
                                                                            <option>创新创业</option>
                                                                            <option>名师讲座</option>
                                                                        </select>
                                                                    </div>
                                                                </div>

                                                                <div class="aui-card-form-item">
                                                                    <label class="aui-card-form-label">子模块个数:</label>
                                                                    <div class="aui-card-form-input">
                                                                        <input type="text" style="width: 150px" required
                                                                               id="number"
                                                                               lay-verify="required" placeholder="子模块个数"
                                                                               autocomplete="off" class="layui-input">
                                                                    </div>
                                                                </div>
                                                                <div class="aui-card-form-item">
                                                                    <label class="aui-card-form-label">课程总时长:</label>
                                                                    <div class="aui-card-form-input">
                                                                        <input type="text" style="width: 150px" required
                                                                               id="time"
                                                                               lay-verify="required"
                                                                               placeholder="课程总时长（分钟）"
                                                                               autocomplete="off" class="layui-input">
                                                                    </div>
                                                                </div>
                                                                <div class="ydc-btn">
                                                                    <button id="publish" class="btn">发布</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="layui-col-xs6">
                                                            <div class="grid-demo">

                                                                <div class="layui-upload">
                                                                    <div class="layui-upload-list">
                                                                        <img class="layui-upload-img"
                                                                             style="width: 200px;height: 140px"
                                                                             id="demo1">
                                                                        <p id="demoText"></p>
                                                                    </div>
                                                                    <button type="button" class="layui-btn" id="test1">
                                                                        上传课程缩略图
                                                                    </button>
                                                                    <input id="pic" style="display: none"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--课程视频管理模块-->
                    <div class="layui-tab-item">
                        <table id="table1" class="layui-table" lay-filter="table1"></table>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<input style="display: none" type="file" name="file" id="vedio">
<input style="display: none" type="file" name="file" id="ppt">
<!--引入尾部页面-->
<div id="footer"></div>

<!-- 操作列 -->
<script type="text/html" id="oper-col">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="ppt">ppt</a>
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="vedio">视频</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" style="" lay-event="del">删除</a>
</script>

<!--跳转模块-->
<script type="text/javascript">
    $(function () {
        $("#headers").load("/html/webui/header/header.html");
        $("#footer").load("/html/webui/footer/footer.html");
    });

    layui.config({
        base: '/html/managerui/js/layui/'
    }).extend({
        treetable: 'treetable-lay/treetable'
    });

    //课程图片上传方法
    layui.use('upload', function () {
        var $ = layui.jquery
            , upload = layui.upload;
        //普通图片上传
        var uploadInst = upload.render({
            elem: '#test1'
            , url: '/manager/leasson/leassonImgUpload'
            , before: function (obj) {
                obj.preview(function (index, file, result) {
                    $('#demo1').attr('src', result); //图片链接（base64）
                });
            }, done: function (res) {
                if (res.data.src !== null) {
                    $("#pic").val(res.data.src);
                    return layer.msg('上传成功');
                }
            }, error: function () {
            }
        });
    })


    //tab标签页引用
    layui.use(['layer', 'table', 'treetable', 'element', 'upload'], function () {
        var $ = layui.jquery
            , element = layui.element;
        var table = layui.table;
        var upload = layui.upload;
        var layer = layui.layer;
        var treetable = layui.treetable;

        //一些事件监听
        element.on('tab(demo)', function (data) {
            if (data.index === 1) {
                $.ajax({
                    type: "GET",
                    url: "/manager/leasson/getLeassonInfo",
                    data: {
                        page: 1
                    },
                    success: function (data) {
                        treetable.render({
                            treeColIndex: 0,
                            treeSpid: -1,
                            treeIdName: 'name',
                            treePidName: 'name',
                            treeDefaultClose: true,
                            treeLinkage: false,

                            elem: '#table1',
                            data: data.data,
                            page: true,
                            cols: [[
                                {field: 'courseName', title: '课程名称'},
                                {field: 'courseVedioName', edit: 'text', align: "center", title: '章节名称'},
                                {field: 'status', align: "center", width: 120, title: '状态'},
                                {field: 'courseVedioDuringtime', edit: 'text', width: 80, align: "center", title: '时长'},
                                {templet: '#oper-col', align: "center", title: '操作'}
                            ]]
                        });
                    },
                    error: function (data) {
                        layer.msg('参数异常');
                    }
                });
            }
        });

        //上传vedio
        upload.render({
            elem: '#vedio'
            , url: '/manager/leasson/leassonVedioUpload' //改成您自己的上传接口
            , data: {
                course_vedio_id: localStorage.getItem("course_vedio_id"),
                fileUpload_type: "vedio"
            }
            , accept: 'file',
            before: function (obj) {
                layer.load(2);
            },
            done: function (res) {
                layer.closeAll('loading');
                layer.msg('视频上传成功', {
                    offset: 't',
                    anim: 6
                });
            }
        });

        //上传ppt
        upload.render({
            elem: '#ppt'
            , url: '/manager/leasson/leassonVedioUpload' //改成您自己的上传接口
            , data: {
                course_vedio_id: localStorage.getItem("course_vedio_id"),
                fileUpload_type: "ppt"
            },
            accept: 'file',
            before: function (obj) {
                layer.load(2);
            },
            done: function (res) {
                layer.closeAll('loading');
                layer.msg('ppt上传成功', {
                    offset: 't',
                    anim: 6
                });
            }
        });


        //监听工具条
        table.on('tool(table1)', function (obj) {
            var data = obj.data;
            var layEvent = obj.event;
            if (obj.data.courseVedioId != null) {
                localStorage.setItem("course_vedio_id", obj.data.courseVedioId);
                if (layEvent === 'del') {
                    layer.msg('删除' + data);
                } else if (layEvent === 'ppt') {
                    $("#ppt").click();
                } else if (layEvent === 'vedio') {
                    $("#vedio").click();
                }
            }
        });


        //监听单元格编辑
        table.on('edit(table1)', function (obj) {
            update(obj);
        });

        function update(obj) {
            if (obj.data.courseVedioId != null) {
                $.ajax({
                    type: "POST",
                    url: "/manager/leasson/updateLeasson",
                    contentType: "application/json",
                    data: JSON.stringify(obj.data),
                    success: function (data) {
                        if (data.code === 200) {
                            layer.msg('更新成功', {
                                icon: 16
                                , shade: 0.01
                            });
                        } else
                            layer.msg('网络异常，请稍后重试');
                    },
                    error: function (data) {
                        layer.msg('参数异常');
                    }
                });
            }
        }
    });


    //课程说明图片上传方法
    layui.use('layedit', function () {
        var layedit = layui.layedit;
        layedit.set({
            uploadImage: {
                url: '/user/news/newImagesUpload' //接口url
                , type: 'POST' //默认post
            }
        });
        var editor = layedit.build('LAY_demo1', {
            height: 170
        });

        //点击发布按钮的操作
        $("#publish").click(function () {
            var title = $("#title").val();
            var teacher = $("#teacher").val();
            var introduction = layedit.getContent(editor);
            var category = $("#category option:selected").val();
            var number = $("#number").val();
            var time = $("#time").val();
            var picUrl = $("#pic").val();

            if (title.length === 5 || title.length > 30 || teacher.length === 0 || teacher.length > 20
                || introduction.length === 0 || category.length === 0 || number.length === 0 || time.length === 0 || picUrl.length === 0) {
                layer.msg('请填写完整信息！');
                return;
            }
            var data = {
                "courseName": title,
                "courseTotalblocks": number,
                "courseTeacher": teacher,
                "courseType": category,
                "courseTotaltime": time,
                "courseDescription": introduction,
                "courseImg": picUrl
            };

            $.ajax({
                type: "POST",
                url: "/manager/leasson/applyLeasson",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (data) {
                    if (data.code === 200) {
                        layer.msg('发布成功', {
                            icon: 16
                            , shade: 0.01
                        });
                    } else
                        layer.msg('网络异常，请稍后重试');
                },
                error: function (data) {
                    layer.msg('参数异常');
                }
            });
        })
    });

    function textLimitCheck(thisArea, maxLength) {
        if (thisArea.value.length > maxLength) {
            thisArea.value = thisArea.value.substring(0, 30);
            thisArea.focus();
        }
        messageCount.innerText = thisArea.value.length;
    }


</script>


</body>
</html>
