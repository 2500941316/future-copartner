<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>个人工作台</title>
    <link rel="stylesheet" type="text/css" href="/html/managerui/css/layout.css"/>
    <link rel="stylesheet" type="text/css" href="/html/managerui/css/hyzx.css"/>
    <link type="text/css" rel="stylesheet" href="/html/webui/css/home.css"/>

    <link type="text/css" rel="stylesheet" href="/html/webui/js/layui/css/layui.css"/>
    <script type="text/javascript" src="/html/webui/js/layui/layui.all.js"></script>
</head>
<body>
<!--<div id="hy_con">

    <div id="con_rh">
        <div class="con_rh_con">-->
       <!--     <div class="layui-tab" lay-filter="demo">-->

                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">

                        <div class="perRightcon">
                            <div class="ydc-column ydc-column-8">
                                <div class="ydc-release-content">
                                    <div class="ydc-tabPanel ydc-tabPanel-release">
                                        <div class="ydc-panes" >
                                            <div class="ydc-pane" style="display:block;">

                                                <div class="ydc-form-city" style="margin-top: 5px;padding: 0 20px;">
                                                    <div class="layui-row">

                                                        <div class="layui-col-xs8">
                                                            <div class="aui-card-form-item">
                                                                <label class="aui-card-form-label">直播标题:</label>
                                                                <div class="aui-card-form-input">
                                                                    <input type="text" style="width: 300px" required
                                                                           id="liveTitle"
                                                                           lay-verify="required" placeholder="请填写直播标题"
                                                                           autocomplete="off" class="layui-input">
                                                                </div>
                                                            </div>
                                                            <div class="aui-card-form-item">
                                                                <label class="aui-card-form-label">直播链接:</label>
                                                                <div class="aui-card-form-input">
                                                                    <input type="text" style="width: 300px" required
                                                                           id="liveUrl"
                                                                           lay-verify="required"
                                                                           placeholder="请完整填写直播链接"
                                                                           autocomplete="off" class="layui-input">
                                                                </div>
                                                            </div>
                                                            <div class="aui-card-form-item">
                                                                <label class="aui-card-form-label">开始时间:</label>
                                                                <div class="aui-card-form-input">
                                                                    <input type="text" style="width: 300px" required
                                                                           id="startTime"
                                                                           lay-verify="required"
                                                                           placeholder="直播开始时间（格式：2021-01-01 08:00:00）"
                                                                           autocomplete="off" class="layui-input">
                                                                </div>
                                                            </div>
                                                            <div class="aui-card-form-item">
                                                                <label class="aui-card-form-label">直播时长:</label>
                                                                <div class="aui-card-form-input" >
                                                                    <select id="liveDuration" style="width: 300px">
                                                                        <option value="1">1小时</option>
                                                                        <option value="2">2小时</option>
                                                                        <option value="3">3小时</option>
                                                                        <option value="4">4小时</option>
                                                                        <option value="5">5小时</option>
                                                                        <option value="6">6小时</option>
                                                                        <option value="7">7小时</option>
                                                                        <option value="8">8小时</option>
                                                                        <option value="9">9小时</option>
                                                                        <option value="10">10小时</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                              <div class="aui-card-form-item">
                                                                  <label class="aui-card-form-label">直播简述:</label>
                                                                  <div class="aui-card-form-input">
                                                                      <textarea id="liveDescription" style="width: 300px" required
                                                                                autocomplete="off"
                                                                                onkeyUp="liveTextLimitCheck(this, 60);"
                                                                                ></textarea>
                                                                      <br /><span id="messageCount">0</span>/60
                                                                  </div>
                                                              </div>

                                                        </div>

                                                        <div class="layui-col-xs4">
                                                            <div class="grid-demo">
                                                                <div class="layui-upload">
                                                                    <div class="layui-upload-list">
                                                                        <img class="layui-upload-img"
                                                                             style="height: 140px;width: 200px;"
                                                                             id="imgId">
                                                                        <p id="demoText"></p>
                                                                    </div>
                                                                    <button type="button" class="layui-btn" id="upImageBtn">
                                                                        上传直播照片
                                                                    </button>
                                                                    <input id="picture" style="display: none"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>

                                                <div class="ydc-release-form-text">
                                                    <div class="ydc-btn" style="height: 50px;padding-top: 20px;">
                                                        <button id="publishSup" class="btn">提交修改</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
   <!--         </div>-->
<!--        </div>
    </div>
</div>-->



<script type="application/javascript">

    var $ = layui.jquery;

    $(function () {
        searchLiveById();
    })

    // 时间组件
    layui.use('laydate', function(){
        var laydate = layui.laydate;
        laydate.render({
            elem: '#startTime', //指定元素
            format: 'yyyy-MM-dd HH:mm',
            type: 'datetime',
            trigger: 'click'
        });
    });

    //直播图片上传方法
    layui.use('upload', function () {
        var $ = layui.jquery
            , upload = layui.upload;
        //普通图片上传
        var uploadInst = upload.render({
            elem: '#upImageBtn'
            , url: '/manager/supervisor/supervisorImgUpload'
            , before: function (obj) {
                obj.preview(function (index, file, result) {
                    $('#imgId').attr('src', result); //图片链接（base64）
                });
            }, done: function (res) {
                if (res.data.src !== null) {
                    $("#picture").val(res.data.src);
                    return layer.msg('上传成功');
                }
            }, error: function () {
            }
        });
    })

    /**
     * 查询直播信息
     */
    function searchLiveById(){
        var liveId = localStorage.getItem("liveId",liveId);
        $.ajax({
            url: "/manager/live/searchLiveById",
            type: "GET",
            data: "liveId="+liveId,
            success: function (res) {
                if(res.code = 200){
                    fillLiveInfo(res.data[0]);
                }else{
                    layer.msg("网络异常！");
                }
            },
            error: function () {
                layer.msg("网络异常！");
            }
        })
    }

    /**
     * 填充直播信息
     * @param liveInfo
     */
    function fillLiveInfo(liveInfo){
        $("#liveTitle").val(liveInfo.liveTitle);
        $("#liveUrl").val(liveInfo.liveUrl);
        $("#startTime").val(liveInfo.startTime);
        $("#liveDuration").val(liveInfo.liveDuration);
        $("#liveDescription").val(liveInfo.liveDescription);

        document.getElementById("imgId").src = liveInfo.liveImage; // src格式
        $("#picture").val(liveInfo.liveImage);
    }

        //点击发布按钮的操作
        $("#publishSup").click(function () {
            var liveId = localStorage.getItem("liveId",liveId);
            var liveTitle = $("#liveTitle").val();
            var liveUrl = $("#liveUrl").val();
            var startTime = $("#startTime").val();
            var liveDuration = $("#liveDuration").val();
            var liveDescription = $("#liveDescription").val();
            var liveImage = $("#picture").val();


            if (liveTitle.length === 0 || liveUrl.length === 0 || startTime.length === 0
                ||liveDuration.length === 0) {
                top.layer.msg('请填写完整信息！',{icon: 7,shade: 0.01});
                return;
            }
            if(liveImage.length === 0){
                // 没有上传照片，则设置一个默认照片
                liveImage = "/html/webui/live/image/1532513058.jpg";
            }
            var data = {
                 liveId: liveId,
                 liveTitle: liveTitle,
                 liveUrl: liveUrl,
                 startTime : startTime,
                 liveDuration : liveDuration,
                 liveDescription : liveDescription,
                 liveImage : liveImage,
            };
            console.log(data);
            $.ajax({
                type: "POST",
                url: "/manager/live/updateLiveInfo",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (data) {
                    if (data.code === 200) {
                        layer.msg('修改成功', {icon: 1, shade: 0.05});
                    } else
                        layer.msg('网络异常，请稍后重试');
                },
                error: function (data) {
                    layer.msg('网络异常！');
                }
            });
        })


    function liveTextLimitCheck(thisArea, maxLength) {
        if (thisArea.value.length > maxLength) {
            thisArea.value = thisArea.value.substring(0, 60);
            thisArea.focus();
        }
        messageCount.innerText = thisArea.value.length;
    }

</script>

</body>
</html>
