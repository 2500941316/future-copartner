<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link type="text/css" rel="stylesheet" href="/html/webui/css/personal.css"/>
    <link type="text/css" rel="stylesheet" href="/html/webui/css/home.css"/>
    <link type="text/css" rel="stylesheet" href="/html/managerui/js/layui/css/layui.css"/>
    <script type="text/javascript" src="/html/webui/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="/html/webui/js/personal.js"></script>
    <script type="text/javascript" src="/html/managerui/js/layui/layui.js"></script>

    <title>我的项目</title>

   <!-- <style type="text/css">
        .plan{
            cursor: pointer;
        }
    </style>-->
</head>

<body>

<div class="perRightcon">
        <div class="clear" style="margin-top: 15px"></div>
    <div class="commonTit">
        <h1 class="fl">我的项目</h1>
        <!--<div class="dqzt">
            <label>当前状态：</label>
            <span>目前处于离职状态，可即刻上岗</span>
            <span class="jticon"></span>
        </div>-->
        <div class="clear"></div>
    </div>

        <div class="jianliBox" id="tableDiv">
                <!--展示数据-->
        </div>
    <div class="clear"></div>
    <div class="addJl">
        <a href="personal_project_apply.html">
            <span>继续申请项目</span>
            <label>（还可申请2个项目）</label>
        </a>
    </div>
    <div class="clear"></div>

</div>

<script type="text/javascript">
    // 弹出层
    layui.use('layer', function(){
        var layer = layui.layer;
    });

       $(function () {
           $.ajax({
               url: "/user/project/selectByCreater",    //请求的url地址
               dataType: "json",   //返回格式为json
               contentType: "application/json",
               async: true, //请求是否异步，默认为异步，这也是ajax重要特性
             //  data: JSON.stringify(data),   //参数值
               type: "GET",   //请求方式
               success: function(req) {
                   if(req.code == 200){
                       console.log(req)
                       fillProjectInfo(req.data)
                   }else{
                       layer.msg("网络异常，请稍后重试！")
                   }
               },
               error: function(req) {
                   //请求出错处理
                   console.log(req);
                   layer.msg('参数异常');
               }
           });
    })

    function fillProjectInfo (projectData) {
          const $active = $("#tableDiv");
          $active.html("");
          for(var i in projectData){
              var $children = $(
                  ' <table id="myProjectTable" width="100%" border="0" cellpadding="0" cellspacing="5">\n' +
                  '            <tr id="first-tr">\n' +
                  '                <td colspan="5">\n' +
                  '                    <div class="jlpart1">\n' +
                  '                         <div class="jlName"><a href="personal_jlupdate.html"><span id="projectName">'+ projectData[i].projectName +'</span></a></div>\n' +
                  '                         <div class="jlDate">开始时间：<span id="starttime">'+ projectData[i].starttime +'</span></div>\n' +
                  '                         <div class="jlDate">状态：<span id="projectStatus" style="font: bold">'+ projectData[i].projectStatus +'</span></div>\n' +
                  '                         <div class="jlFresh"><a href="/html/webui/personal/personal_project_list.html">更新</a></div>\n' +
                  '                    </div>\n' +
                  '                </td>\n' +
                  '            </tr>\n' +
                  '            <tr id="second-tr" >\n' +
                  '                <td width="61%">\n' +
                  '                    <div class="jlpart2">\n' +
                  '                        <div class="Orange" style="width:40px;"></div>\n' +
                  '                    </div>\n' +
                  '                    <div class="jlpart3">\n' +
                  '                        完整度 20 %\n' +
                  '                        [ <a href="/html/webui/project/project_concret_info.html" target = "blank">修改</a>\n' +
                  '                        <a onclick="viewProjectDetail('+projectData[i].projectId+')" href="#">查看</a>\n' +
                  '                        <a href="/html/webui/project/project_search.html" target = "blank">下载</a> ]</div>\n' +
                  '                </td>\n' +
                  '            <td rowspan="2">\n' +
                  '                       <div class="jlpart4">\n' +
                  '                          <div class="red"><i class="layui-icon layui-icon-video"></i>  </div>\n' +
                  '                          <div class="tdname"><button type="button" style="border-style: none; outline: none;background: none; cursor: pointer" id="upVideo"><span id="currentVideoId" style="display:none;">'+projectData[i].projectId+'</span>上传视频</button></div>\n' +
                  '                       </div>\n' +
                  '                </td>\n'+
                  '            <td rowspan="2">\n' +
                  '                       <div class="jlpart4">\n' +
                  '                          <div class="red"><i class="layui-icon layui-icon-upload-drag"></i>  </div>\n' +
                  '                          <div class="tdname"><button type="button" style="border-style: none; outline: none;background: none; cursor: pointer" id="upPlan"><span id="currentPlanId" style="display:none;">'+projectData[i].projectId+'</span>上传计划书</button></div>\n' +
                  '                       </div>\n' +
                  '                </td>\n'+
                  '                <td rowspan="2">\n' +
                  '                    <div class="jlpart4">\n' +
                  '                        <div class="delicon"></div>\n' +
                  '                        <div class="tdname">删除</div>\n' +
                  '                    </div>\n' +
                  '                </td>\n' +

                  '            </tr>\n' +
                  '            <tr id="third-tr">\n' +
                  '                <td width="61%">\n' +
                  '                </td>\n' +
                  '            </tr>\n' +
                  '            <tr id="fourth-tr">\n' +
                  '                <td colspan="5">\n' +
                  '                    <div class="divline"></div>\n' +
                  '                </td>\n' +
                  '            </tr>\n' +
                  '\n' +
                  '        </table>'

           );
              $active.append($children);
          }
    }

    function viewProjectDetail(projectId) {
           layer.msg("projectId:"+projectId);
        localStorage.setItem("projectId",projectId);
        //window.open("/html/webui/project/project_details_info.html");
        window.location.href = "/html/webui/project/project_details_info.html";

    }

    layui.use(['upload','layer'], function() {
        var layer = layui.layer;
        //  layer.msg("ssssss");
        var upload = layui.upload;
        //上传视频
        upload.render({
            elem: '#upVideo'
            ,url: '/user/project/uploadVideo'
            ,data: {projectId: function(){return document.getElementById("currentVideoId").innerText;}}
            ,accept: 'video' //视频
            ,done: function(res){
                if(res.code == 200){
                    layer.msg('上传成功');
                    console.log(res);
                }else{
                    layer.msg('网络异常');
                    console.log(res);
                }
            }
        });

        // 上传计划书
        upload.render({
            elem: '#upPlan'
            ,url: '/user/project/uploadPlan'
            ,data: {projectId: function(){return document.getElementById("currentPlanId").innerText;}}
            ,accept: 'file' //普通文件
            ,done: function(res){
                if(res.code == 200){
                    layer.msg('上传成功');
                    console.log(res);
                }else{
                    layer.msg('网络异常');
                    console.log(res);
                }
            }
        });
    })


</script>

</body>
</html>