<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link type="text/css" rel="stylesheet" href="/html/webui/css/personal.css" />
   <link type="text/css" rel="stylesheet" href="/html/webui/js/layui/css/layui.css"/>
   <script src="/html/webui/js/layui/layui.all.js"></script>

   <!--<script type="text/javascript" src="/html/webui/js/personal.js"></script>-->


<title>修改项目信息</title>
</head>

<body style="min-height: 1200px">
   <div class="perRightcon">
      <div class="JlBoxCon">
         <h1><span>项目信息</span><div><a onclick="submitUpdateProject()" class="update" style="cursor: pointer;">提交修改</a></div></h1>
         <div class="JlBoxLeft">
            <div class="jldiv">
               <div class="nametxt"><span>*</span>项目名称：</div>
               <div class="inputtxt">
                  <input id="projectName" name="" type="text" class="txt3" autocomplete="off"/>
               </div>
            </div>
            <div class="jldiv">
               <div class="nametxt"><span>*</span>项目类别：</div>
               <div class="inputtxt">
                  <select name="" id="projectType" style="width: 235px;height: 35px;line-height: 35px;border: 1px #DBDBDB solid;border-radius: 4px;">
                     <option value="" selected disabled hidden>请选择项目类别</option>
                     <option value="新零售">新零售</option>
                     <option value="文创">文创</option>
                     <option value="科创">科创</option>
                     <option value="K12">K12</option>
                     <option value="校园行">校园行</option>
                     <option value="其他">其他</option>
                  </select>
               </div>
            </div>
            <div class="clear"></div>
            <div class="jldiv">
               <div class="nametxt"><span>*</span>时 间：</div>
               <div class="inputtxt">
                  <input id="starttime" name="" type="text" class="txt3" autocomplete="off"/>
               </div>
            </div>
            <div class="jldiv">
               <div class="nametxt"><span>*</span>负责人：</div>
               <div class="inputtxt">
                  <input id="mainPeople" name="" type="text" class="txt3" autocomplete="off"/>
               </div>
            </div>
            <div class="clear"></div>
            <div class="jldiv">
               <div class="nametxt">辅导教师：</div>
               <div class="inputtxt">
                  <select name="" id="projectSupervisor" style="width: 235px;height: 35px;line-height: 35px;border: 1px #DBDBDB solid;border-radius: 4px;">

                  </select>
               </div>
            </div>
            <div class="clear"></div>
            <!--<div class="jldiv">
               <div class="nametxt">成 员：</div>
               <div class="inputtxt">
                  <textarea id="projectPeople" name="" cols="" rows="" autocomplete="off"></textarea>
               </div>
            </div>-->
            <div class="jldiv">
               <div class="nametxt">项目简述：</div>
               <div class="inputtxt">
                  <textarea id="description" name="" cols="" rows="" autocomplete="off" onkeyUp="textLimitCheck(this, 100);"></textarea>
                  <br /><span id="messageCount">0</span>/100
               </div>

            </div>
         </div>
      </div>
      <div class="clear"></div>
      <div class="JlBoxCon">
         <h1><span>项目里程碑</span><div><a onclick="updateLandmark()" href="#" class="update">提交修改</a></div></h1>
         <div class="JlBoxLeft">
            <!--<div class="jldiv">
               <div class="nametxt">新加入成员：</div>
               <div class="inputtxt">
                  <input name="" id="projectPeopleNew" type="text" class="txt3"/>
                  <input name="" id="peopleTime" type="text" class="txt2" placeHolder="加入时间" autocomplete="off"/>
               </div>
            </div>-->
            <div class="clear"></div>
            <div class="jldiv">
               <div class="nametxt">项目比赛：</div>
               <div class="inputtxt">
                  <input name="" id="projectMatch" type="text" class="txt3" />
                  <input name="" id="matchTime" type="text" class="txt2" placeHolder="更新时间" autocomplete="off"/>
               </div>
            </div>
            <div class="clear"></div>
            <div class="jldiv">
               <div class="nametxt">项目合作：</div>
               <div class="inputtxt">
                  <input name="" id="projectCooperation" type="text" class="txt3" />
                  <input name="" id="cooperationTime" type="text" class="txt2" placeHolder="合作时间" autocomplete="off"/>
            </div>
            <div class="clear"></div>
            <div class="jldiv">
               <div class="nametxt">项目重要市场活动：</div>
               <div class="inputtxt">
                  <textarea  name="" id="projectActivity" cols="" rows="2" autocomplete="off" style="width: 450px"></textarea>
                  <input name="" id="activityTime" type="text" class="txt2" placeHolder="活动时间" style="margin-top: 5px;" autocomplete="off"/>
               </div>
            </div>
            <div class="clear"></div>
            <div class="jldiv">
               <div class="nametxt">项目服务产品开发：</div>
               <div class="inputtxt">
                  <input name="" id="projectService" type="text" class="txt3"/>
                  <input name="" id="serviceTime" type="text" class="txt2" placeHolder="更新时间" autocomplete="off"/>
               </div>
            </div>
            <div class="clear"></div>
            <div class="jldiv">
               <div class="nametxt">项目融资：</div>
               <div class="inputtxt">
                  <input name="" id="projectFinance" type="text" class="txt3"/>
                  <input name="" id="financeTime" type="text" class="txt2" placeHolder="更新时间" autocomplete="off"/>
               </div>
            </div>
            <div class="clear"></div>
               <div class="jldiv">
                  <div class="nametxt">项目产生营收：</div>
                  <div class="inputtxt">
                     <input name="" id="projectIncome" type="text" class="txt3"/>
                     <input name="" id="incomeTime" type="text" class="txt2" placeHolder="更新时间" autocomplete="off"/>
                  </div>
               </div>

               <div class="clear"></div>
               <div class="jldiv">
                  <div class="nametxt">项目注册公司：</div>
                  <div class="inputtxt">
                     <input name="" id="projectCompany" type="text" class="txt3" />
                     <input name="" id="companyTime" type="text" class="txt2" placeHolder="注册时间" autocomplete="off"/>
                  </div>
               </div>

               <div class="clear"></div>
               <div class="jldiv">
                  <div class="nametxt">其他：</div>
                  <div class="inputtxt">
                     <input name="" id="projectElseInfo"  type="text" class="txt3" />
                     <input name="" id="elseInfoTime" type="text" class="txt2" placeHolder="时间" autocomplete="off"/>
                  </div>
               </div>
         </div>
      </div>
   </div>
   </div>

<script type="text/javascript">

   var $ = layui.jquery;

   $(function () {
      addOptionTeacher();
      getProjectData();
   })

   // 弹出层
   layui.use('layer',function () {
      var layer = layui.layer;
     // top.layer.msg("在哪里")
   })

   // 时间组件
   layui.use('laydate', function(){
      var laydate = layui.laydate;
      //执行一个laydate实例
     /* laydate.render({
         elem: '#peopleTime' //指定元素
         ,trigger: 'click'
      });*/
      laydate.render({
         elem: '#matchTime'
         ,trigger: 'click'
      });
      laydate.render({
         elem: '#cooperationTime'
         ,trigger: 'click'
      });
      laydate.render({
         elem: '#activityTime'
         ,trigger: 'click'
      });
      laydate.render({
         elem: '#serviceTime'
         ,trigger: 'click'
      });
      laydate.render({
         elem: '#financeTime'
         ,trigger: 'click'
      });
      laydate.render({
         elem: '#incomeTime'
         ,trigger: 'click'
      });
      laydate.render({
         elem: '#companyTime'
         ,trigger: 'click'
      });
      laydate.render({
         elem: '#elseInfoTime'
         ,trigger: 'click'
      });
   });


   /**
    * 根据id请求当前项目数据
    */
   function getProjectData() {
      var projectId = localStorage.getItem("projectId");
      $.ajax({
         url: "/public/project/getProjectById",
         async: true,
         data: "projectId=" + projectId,
         type: "GET",   //请求方式
         success: function (req) {
            if (req.code == 200) {
               //console.log(req);
               fillProjectInfo(req.data[0])
            } else {
               layer.msg("网络异常，请稍后重试！")
            }
         },
         error: function (req) {
            //请求出错处理
            console.log(req);
            layer.msg("网络异常，请稍后重试！");
         }
      })
   }

   /**
    * 填充当前项目数据
    * @param projectInfo
    */
   //var teacher;
   function fillProjectInfo(projectInfo) {
      // 基本信息
      $("#projectName").val(projectInfo.projectName);
      $("#projectCreater").val(projectInfo.projectCreater);
      $("#mainPeople").val(projectInfo.mainPeople);
      //$("#projectTeacher").val(projectInfo.projectTeacher);
      //$("#projectPeople").val(projectInfo.projectPeople);
      $("#projectType").val(projectInfo.projectType);
      $("#starttime").val(projectInfo.starttime);
      $("#projectStatus").val(projectInfo.projectStatus);
      $("#description").val(projectInfo.description);
      $("#projectSupervisor").val(projectInfo.supervisorId); // 注意导师文本与值,这里是根据值选中来设置selected
      //$("#projectSupervisor").val(projectInfo.projectTeacher); // 注意导师文本与值,这里是根据值选中来设置selected
      //console.log(projectInfo.projectTeacher);


      // 里程碑信息
        //$("#projectPeopleNew").val(projectInfo.projectPeopleNew),
        $("#projectMatch").val(projectInfo.projectMatch),
        $("#projectCooperation").val(projectInfo.projectCooperation),
        $("#projectActivity").val(projectInfo.projectActivity),
        $("#projectService").val(projectInfo.projectService),
        $("#projectFinance").val(projectInfo.projectFinance),
        $("#projectIncome").val(projectInfo.projectIncome),
        $("#projectCompany").val(projectInfo.projectCompany),
        $("#projectElseInfo").val(projectInfo.projectElseInfo)

        $("#matchTime").val(projectInfo.matchTime)
        $("#peopleTime").val(projectInfo.peopleTime)
        $("#cooperationTime").val(projectInfo.cooperationTime)
        $("#activityTime").val(projectInfo.activityTime)
        $("#serviceTime").val(projectInfo.serviceTime)
        $("#financeTime").val(projectInfo.financeTime)
        $("#incomeTime").val(projectInfo.incomeTime)
        $("#companyTime").val(projectInfo.companyTime)
        $("#elseInfoTime").val(projectInfo.elseInfoTime)
   }

   /**
    * 提交修改
    */
   function submitUpdateProject(){
      var projectId = localStorage.getItem("projectId");

      var updataProject = {
         projectId : projectId,
         projectName : $("#projectName").val(),
         mainPeople : $("#mainPeople").val(),
         //projectTeacher : $("#projectTeacher").val(),
         //projectPeople : $("#projectPeople").val(),
         projectType : $("#projectType").val(),
         starttime : $("#starttime").val(),
         projectStatus : $("#projectStatus").val(),
         description :  $("#description").val(),

         supervisorId :  $("#projectSupervisor").val(),// 获取导师选择框的值
         projectTeacher : $("#projectSupervisor").find("option:selected").text() // 获取导师选择框的文本

      }
      //console.log(updataProject)
      $.ajax({
         url: "/vip/project/updateProject",
         dataType: "json",
         contentType: "application/json",
         data: JSON.stringify(updataProject),
         type: "POST",
         success: function(req) {
            if(req.code == 200){
               top.layer.msg("修改成功！",{icon: 1,shade: 0.05,time:1000})
               window.location.href = "/html/webui/personal/personal_project_list.html";
            }else{
               top.layer.msg("网络异常，请稍后重试！")
            }
         },
         error: function(req) {
            //请求出错处理
            //console.log(req);
            layer.msg('网络异常，请稍后重试！');
         }
      });
   }

   /**
    * 更新项目里程碑
    */
   function updateLandmark() {
      var projectId = localStorage.getItem("projectId");

      var landmarkData = {
         projectId: projectId,
         // 基本信息
         projectName : $("#projectName").val(),
         mainPeople : $("#mainPeople").val(),
         projectType : $("#projectType").val(),
         starttime : $("#starttime").val(),
         // 里程碑信息
         //projectPeopleNew: $("#projectPeopleNew").val(),
         projectMatch: $("#projectMatch").val(),
         projectCooperation: $("#projectCooperation").val(),
         projectActivity: $("#projectActivity").val(),
         projectService: $("#projectService").val(),
         projectFinance: $("#projectFinance").val(),
         projectIncome: $("#projectIncome").val(),
         projectCompany: $("#projectCompany").val(),
         projectElseInfo: $("#projectElseInfo").val(),

         peopleTime: $("#peopleTime").val(),
         matchTime: $("#matchTime").val(),
         cooperationTime: $("#cooperationTime").val(),
         activityTime: $("#activityTime").val(),
         serviceTime: $("#serviceTime").val(),
         financeTime: $("#financeTime").val(),
         incomeTime: $("#incomeTime").val(),
         companyTime: $("#companyTime").val(),
         elseInfoTime: $("#elseInfoTime").val(),
      }
      //console.log(landmarkData)
      // 如果全为空，则提示
      if(landmarkData.projectPeopleNew.length === 0 && landmarkData.projectMatch.length === 0 && landmarkData.projectCooperation.length === 0
              && landmarkData.projectActivity.length === 0 && landmarkData.projectService.length === 0
              && landmarkData.projectFinance.length === 0 && landmarkData.projectIncome.length === 0
              && landmarkData.projectCompany.length === 0 && landmarkData.projectElseInfo.length === 0){
         top.layer.msg("请填写信息！");
      }
      $.ajax({
         url: "/vip/project/updateProject",
         dataType: "json",
         contentType: "application/json",
         data: JSON.stringify(landmarkData),
         type: "POST",
         success: function(req) {
            if(req.code == 200){
               top.layer.msg("修改成功！",{
                  icon: 16,
                  shade: 0.01
               })

            }else{
               top.layer.msg("网络异常，请稍后重试！")
            }
         },
         error: function(req) {
            //请求出错处理
            console.log(req);
            layer.msg('网络异常，请稍后重试！');
         }
      });
   }

   /**
    * 获取指导教师
    */
   function addOptionTeacher() {
      // 获取导师信息
      $.ajax({
         url: "/public/supervisor/searchAllSupervisor",
         type: "GET",
         success: function (res) {
            if(res.code == 200){
               fillProjectTeacher(res.data);
            }else{
               top.layer.msg("网络异常");
            }
         }
      })

   }

   /**
    * 填充指导教师select
    * @param supervisorInfo
    */
   function fillProjectTeacher(supervisorInfo){
      //根据id查找对象，
      var obj=document.getElementById('projectSupervisor');
     /* for(var i in supervisorInfo){
         obj.options[i]=new Option(supervisorInfo[i].supervisorName,supervisorInfo[i].supervisorId);    //第一个参数为文本，第二个从参数为值
      }*/
      var len=supervisorInfo.length;
      for(var i=0;i<len;i++){
         var option=document.createElement("option");
         $("#projectSupervisor").append(('<option value='+supervisorInfo[i].supervisorId+'>'+supervisorInfo[i].supervisorName+'</option>'));
      }
   }

   function textLimitCheck(thisArea, maxLength) {
      if (thisArea.value.length > maxLength) {
         thisArea.value = thisArea.value.substring(0, 100);
         thisArea.focus();
      }
      messageCount.innerText = thisArea.value.length;
   }
</script>
</body>
</html>
